(n  /visit routes
    when the user is staff
      ✓ should allow getting records list
      ✓ should allow downloading records list
      ✓ should forbid getting specific records
      ✓ should forbid requerror: Sending 500 ("Ser  1) "after all" hook

  4 passing (4s)
  1 failing

  1) "after all" hook:

      Uncaught AssertionError: expected 500 to be 200
      + expected - actual

      -500
      +200
      
      at Assertion.fail (node_modules/should/cjs/should.js:275:17)
      at Assertion.value (node_modules/should/cjs/should.js:356:19)
      at ClientRequest.<anonymous> (test/CheckHTTP.js:48:44)
      at HTTPParser.parserOnIncomingClient [as onIncoming] (_http_client.js:565:21)
      at HTTPParser.parserOnHeadersComplete (_http_common.js:111:17)
      at Socket.socketOnData (_http_client.js:451:20)
      at addChunk (_stream_readable.js:288:12)
      at readableAddChunk (_stream_readable.js:269:11)
      at Socket.Readable.push (_stream_readable.js:224:10)
      at TCP.onStreamRead [as onread] (internal/stream_base_commons.js:94:17)



/Pool.js:101:12)
       at Ping.Sequence.end (/workspace/nlcAttendance/node_modules/machinepack-mysql/node_modules/mysql/lib/protocol/sequences/Sequence.js:88:24)
       at Ping.Sequence.OkPacket (/workspace/nlcAttendance/node_modules/machinepack-mysql/node_modules/mysql/lib/protocol/sequences/Sequence.js:97:8)
       at Protocol._parsePacket (/workspace/nlcAttendance/node_modules/machinepack-mysql/node_modules/mysql/lib/protocol/Protocol.js:279:23)
       at Parser.write (/workspace/nlcAttendance/node_modules/machinepack-mysql/node_modules/mysql/lib/protocol/Parser.js:76:12)
       at Protocol.write (/workspace/nlcAttendance/node_modules/machinepack-mysql/node_modules/mysql/lib/protocol/Protocol.js:39:16)
       at Socket.<anonymous> (/workspace/nlcAttendance/node_modules/machinepack-mysql/node_modules/mysql/lib/Connection.js:103:28)
       at Socket.emit (events.js:198:13)
       at addChunk (_stream_readable.js:288:12)
       at readableAddChunk (_stream_readable.js:269:11)
       at Socket.Readable.push (_stream_readable.js:224:10)
       at TCP.onStreamRead [as onread] (internal/stream_base_commons.js:94:17) code: 'POOL_CLOSED' },
  meta:
   { host: 'localhost',
     port: 3306,
     schema: true,
     adapter: 'sails-mysql',
     url: 'mysql://nlc:password@localhost:3306/nlcAttendance',
     identity: 'default' } }

If you are the maintainer of "join", then you can change its implementation to solve the problem (Most of the time, the solution is just to throw an actual Error instance instead.  Alternatively, if the goal was to indicate a particular exception, you could throw any of the special, reserved "exit signals"-- e.g. the code name of any of your defined exits besides "error" or "success").  Otherwise, please file a bug report with the maintainer, or fork your own copy and fix that.
 [?] See https://sailsjs.com/support for help.
    at Object.fn (/workspace/nlcAttendance/api/controllers/visit/download.js:33:41)
    at process._tickCallback (internal/process/next_tick.js:68:7)
events.js:174
      throw er; // Unhandled 'error' event
      ^

Error: connect ECONNREFUSED 127.0.0.1:1337
    at TCPConnectWrap.afterConnect [as oncomplete] (net.js:1107:14)
Emitted 'error' event at:
    at Socket.socketErrorListener (_http_client.js:401:9)
    at Socket.emit (events.js:198:13)
    at emitErrorNT (internal/streams/destroy.js:91:8)
    at emitErrorAndCloseNT (internal/streams/destroy.js:59:3)
    at process._tickCallback (internal/process/next_tick.js:63:19)
